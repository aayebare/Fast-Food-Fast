<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
    <title>home</title>
</head>

<body>
    <div class="container">
        <header>
            <div class="head">
                <a href="order-history.html">
                    <h2>Fast-Food-Fast | Home </h2>
                </a>
            </div>
        </header>
        <div class="content-section-1">
            <h5>Profile picture</h5>
            <img src="../images/logo.jpg" class="account-img">
        </div>
        <div class="content-section">
            <p>Check out other pages</p>
            <ul class="list-group">
                <li><a href="order-history.html">History of Orders</a></li>
                <li class="list-group-item list-group-item-light">New Additions</li>
                <li class="list-group-item list-group-item-light">etc</li>
            </ul>
        </div>
        <div class="content-section-1">
            <div id="items">

            </div>
        </div>
    </div>
    <script>
        window.addEventListener('load', getMenu);
        var token = sessionStorage.getItem('Token');
        console.log(token)
    
        function getMenu() {
            fetch('http://127.0.0.1:5000/api/v1/menu', {
                        headers: {
                            'Authorization': 'Bearer ' + token,
                            credentials: 'include'
                        }
                    }
    
                )
                .then((response) => response.json())
    
            .then((data) => {
    
                let output = '<div></div>';
    
                data.forEach((item) => {
    
                    output
                        += `
    
                    <article>
                    <table >
                        <button type="submit" id="post_order" class="button-2" onClick = "onOrder(${item.item_id})">Order</a></button>
                        <tr>
                            <p id = "detail" >${item.content}</p>
                            <p id="price">Price: ${item.price} ugx</p>
                        </tr>
                    </table>  
                    </article>
                            `
    
                });
    
                document.getElementById('items').innerHTML = output
    
            })
    
        }
    
        function onOrder(item_id) {
    
            fetch('http://127.0.0.1:5000/api/v1/users/orders', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json, text/plain, */*',
                        'Content-type': 'application/json',
                        'Authorization': 'Bearer ' + token,
                        credentials: 'include'
                    },
                    body: JSON.stringify({
                        item_id: item_id
                    })
                })
                .then((res) => res.json())
                .then((data) => {

                if(data.message=='Order successfully placed'){
                alert('order succesfully placed')
                window.location='place-order.html'
                        }
                })
        }
</script>


</body>

</html>
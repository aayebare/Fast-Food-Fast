<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
    <title>receive orders</title>
</head>

<body>
    <a id="logout" href="user-login.html"><h4>Logout and Exit</h4></a> 
    <div class="container">
        <header>
            <div class="head">
                <a href="admin-receive-order.html">
                    <h2>Fast-Food-Fast | Orders</h2>
                </a>
            </div>
        </header>
        <div class="content-section">
            <div>
                <a href="admin-edit-items.html">View available fast food?</a>
            </div>
            <a href="admin-item.html">Add new food item?</a>
        </div>
        <div class="content-section-1">
            <div id="items">

            </div>

        </div>
    </div>
    <script>
        window.addEventListener('load', getOrders);
        document.getElementById('logout').addEventListener('click', logout);
        var token = sessionStorage.getItem('Token');
        function logout(){
            alert('Logout and Exit?')
            sessionStorage.removeItem('Token');
           
        }
        function getOrders(){
            fetch('http://127.0.0.1:5000/api/v1/orders',{
                headers:{'Authorization': 'Bearer '+ token,
                credentials:'include'
                    }
            }	
                
            )
            .then((response)=> response.json())  
            .then((data)=>{
                let output = '<div></div>';
                
                data.forEach((item)=>{
                    
                    output
                    +=`
    
                    <article>
                    <table>
                        <p class="date">
                        <select id="select_id" name="selector" class="content-section-3" onchange="changeValue(this,${item.order_id})">
                            <option value="new" id="new"> New</option>
                            <option value="processing"> processing</option>
                            <option value="cancelled"> cancelled</option>
                            <option value="complete"> complete</option>
                        </select>
                       
                     </p> 
                        <tr>
                            <p>${item.date}</p>
                            <p id="order">${item.content}</p>
                            <p id="order">order status: ${item.status} </p>	   
                        </tr>
                    </table>  
                    </article>
                    `	  
                });
            
                document.getElementById('items').innerHTML=output
            })
            
        }
    
        function changeValue(x, order_id){
    
            let id = order_id;
            let url  = 'http://127.0.0.1:5000/api/v1/​​orders​/'+ id
            fetch(url,{
                    method:'PUT',
                    headers:{'Accept':'application/json, text/plain, */*',
                        'Content-type':'application/json',
                        'Authorization': 'Bearer '+ token,
                credentials:'include'},
                    body:JSON.stringify({order_status:x.value})   
                })
                .then((res)=>res.json())
                .then((data)=>{
                    if(data.message=='order succesfully updated'){
                    alert('status updated to '+x.value)
                    // sessionStorage.setItem('Token', data.token);
                    
                    window.location='admin-receive-order.html'
                    }
                })
        }
        </script>	

</body>

</html>
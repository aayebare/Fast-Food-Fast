<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
    <title>receive orders</title>
</head>

<body>
    <div class="container">
        <header>
            <div class="head">
                <a href="admin-receive-order.html">
                    <h2>Fast-Food-Fast | Orders</h2>
                </a>
            </div>
        </header>
        <div class="content-section">
            <div>
                <a href="admin-edit-items.html">View available fast food?</a>
            </div>
            <a href="admin-item.html">Add new food item?</a>
        </div>
        <div class="content-section-1">
            <div id="items">

            </div>

        </div>
    </div>
    <script>
        window.addEventListener('load', getOrders);
        var token = sessionStorage.getItem('Token');
        console.log(token)
    
        function getOrders() {
            fetch('http://127.0.0.1:5000/api/v1/orders', {
                        headers: {
                            'Authorization': 'Bearer ' + token,
                            credentials: 'include'
                        }
                    }
    
                )
                .then((response) => response.json())
    
            .then((data) => {
    
                let output = '<div></div>';
    
                data.forEach((item) => {
    
                    output
                        += `
    
                    <article>
                    <table>
                        <p class="date">
                        <select id="select_id">
                            <option value="new" id="new"> New</option>
                            <option value="processing" id="processing"> processing</option>
                            <option value="cancelled" id="cancelled"> cancelled</option>
                            <option value="complete" id="complete"> complete</option>
                        </select>
                       
                <button type="submit" class="button-1" onClick="editStatus(${item.order_id})">Edit status</button>  
                     </p> 
                        <tr>
                            <p>${item.date}</p>
                            <p>${item.content}</p>
                            <p>order status: ${item.status} </p>	   
                        </tr>
                    </table>  
                    </article>
                    `

                });
    
                document.getElementById('items').innerHTML = output

            })
    
        }
        function editStatus(order_id) {
            console.log(order_id)
            let select_id = "select_" + order_id
            select_element = document.getElementById('select_id').value;
            let id = order_id;
            let url = 'http://127.0.0.1:5000/api/v1/​​orders​/s' + id
            fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Accept': 'application/json, text/plain, */*',
                        'Content-type': 'application/json',
                        'Authorization': 'Bearer ' + token,
                        credentials: 'include'
                    },
                    body: JSON.stringify({
                        order_status: select_element
                    })
                })
                .then((res) => res.json())
                .then((data) => {
                })
    
        }
    </script>


</body>

</html>